# RAG Assistant — локальный помощник по файлам (контекстное меню)

Коротко: это приложение индексирует локальные документы (PDF, TXT, DOCX, HTML, MD, PNG/JPG с OCR) и позволяет задавать вопросы по содержимому. Добавлена поддержка контекстного меню Windows (ПКМ) — два пункта: "RAG: Рассказать об этом" и "RAG: Спросить у ассистента" — для файлов и папок.

Основные возможности
- Индексация папки с документами и хранение индекса в централизованном кеше (не в самой папке).
- Контекстное меню в Проводнике для быстрого запуска в режимах "рассказать" (авто-вопрос) и "спросить" (интерактивный чат).
- OCR для изображений через EasyOCR.

Требования
- Windows (рекомендовано).
- Python 3.10+ (примеры ниже для PowerShell).
- Рекомендуется виртуальное окружение и установка зависимостей из `requirements.txt`.
- Для локальных моделей — Ollama должен быть запущен (`ollama serve`) и нужные модели должны быть загружены (`ollama pull`).

Установка зависимостей
1. Создайте и активируйте виртуальное окружение (PowerShell):

```powershell
python -m venv .venv
& .\.venv\Scripts\Activate.ps1
```

2. Установите зависимости:

```powershell
pip install -r requirements.txt
```

Запуск приложения вручную

- Открыть GUI и начать работу (без указания папки):

```powershell
python .\src\app.py
```

- Открыть GUI и сразу указать папку для индексации:

```powershell
python .\src\app.py "C:\Path\To\Folder"
```

- Запустить в режиме контекстного действия "рассказать" (имитация вызова из Проводника):

```powershell
python .\src\app.py "C:\Path\To\FolderOrFile" --tell
```

- Запустить в режиме, где пользователь вводит вопрос вручную:

```powershell
python .\src\app.py "C:\Path\To\FolderOrFile" --ask
```

Установка пунктов контекстного меню (ПКМ)

Скрипт `scripts/install_context_menu.py` регистрирует два пункта в реестре пользователя (HKCU), без прав администратора:

```powershell
& .\.venv\Scripts\Activate.ps1   # активируйте окружение, чтобы регистрация использовала нужный python
python .\scripts\install_context_menu.py install
```

Пункты создаются для файлов и папок. Скрипт пытается использовать `pythonw.exe` (чтобы не открывать консоль). Если вы хотите видеть логи — запускайте `app.py` вручную (через `python`, а не `pythonw`).

Удаление пунктов контекстного меню

```powershell
python .\scripts\install_context_menu.py uninstall
```

Где хранятся кеши и индексы

- Все временные файлы и индексы теперь сохраняются централизованно, а не в индексируемой папке. По умолчанию расположение на Windows:

```
%LOCALAPPDATA%\RAGAssistant\<имя_папки>_<hash16>\
```

В этой папке вы увидите `faiss_index/`, `file_timestamps.pkl`, `summary_cache.pkl`, `summary_hash.txt` и т.п. Для удобства, когда вы открываете папку в GUI, путь к кешу выводится в подсказке (tooltip) над меткой папки.

Примечание: если `LOCALAPPDATA` не задано, используется `~/.cache/rag_assistant`.

Тестирование контекстного меню

1. Убедитесь, что вы устанавливали контекстное меню из того же Python/venv, который используете для запуска приложения.
2. Правый клик по файлу или папке → `RAG: Рассказать об этом`. Должно открыться GUI и после индексации приложение автоматически показать краткое резюме.
3. Правый клик → `RAG: Спросить у ассистента`. GUI откроется и фокус перейдёт на поле ввода.

Советы по отладке
- Если при запуске из контекстного меню появляется окно терминала — это значит, что команда в реестре использует `python.exe`. Переустановите контекстное меню, запустив `install` из venv: он постарается зарегистрировать `pythonw.exe`.
- Если индексация не запускается или нет ответа от модели — убедитесь, что Ollama запущен и модель загружена (`ollama serve` и `ollama pull <model>`).
- Чтобы увидеть логи индексации, запускайте `python .\src\app.py ...` вручную в терминале (не `pythonw`).

Опции для продакшна
- Для более удобной установки рекомендую собрать Windows-исполняемый файл (pyinstaller/briefcase) и регистрировать путь к exe в реестре вместо `python.exe`/`pythonw.exe`. Тогда установка будет надёжнее (и вне зависимости от виртуального окружения).

Контакты и вклад
- Если нужно, я могу: добавить кнопку "Открыть кеш" в интерфейс, обновить скрипт установки для exe, или сгенерировать краткий инсталлятор. Напишите, что предпочтительнее.

---
Автор: локальная разработка — быстрый RAG-инструмент для поиска по файлам.
# RAG Assistant


## Установка
```bash
pip install -r requirements.txt (Там куча всякого, потому что я занёс туда все зависимости через pip freeze, возможно там будет что-то что не используется. К слову гарантий нет что всё сразу хорошо станет, потому что что-то я устанавливал через pip install -U. Но про это мне писалось в консоли когда что-то не срабатывало)
Скачай ollama
перезапусти IDE
ollama pull embeddinggemma:latest mistral:7b-instruct-v0.2-q4_0
Установи CUDA если у тебя видюха NVIDIA, ещё cuDNN и перезапусти комп #у меня просто не работало без этого
Если нет CUDA то лучше поставь сделай ollama pull gemma2:2b-instruct-q4_K_M и в конфиге поставь её как основную.
```

## Запуск
```bash
Останови ollama которая у тебя запущенна как процесс-демон 
Во втором терминале сделай ollama serve
В первом сделай python .\src\main.py C:\D\BSUIR\sem5\RAG\assets\test_files
```

## Этапы разработки
